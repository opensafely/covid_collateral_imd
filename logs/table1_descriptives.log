-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/table1_descriptives.log
  log type:  text
 opened on:  15 May 2023, 08:42:32

. 
. cap mkdir ./output/tables

. 
. * Create  baseline tables for 3 years
. forvalues i=2019/2021 {
  2.   * Import csv file
.     import delimited ./output/measures/input_`i'-01-01.csv, clear
  3.     *update variable with missing so that 0 is shown as unknown (just for 
> this table)
.     *(1) IMD
.     replace imd=6 if imd==0
  4. 
.     * Create age categories
.     egen age_cat = cut(age), at(18, 40, 60, 80, 120) icodes
  5.     label define age 0 "18 - 40 years" 1 "41 - 60 years" 2 "61 - 80 years"
>  3 ">80 years"
  6.     label values age_cat age
  7.     bys age_cat: sum age
  8. 
.     *generate a binary rural urban (with missing assigned to urban)
.     generate urban_rural_bin=.
  9.     replace urban_rural_bin=1 if urban_rural<=4|urban_rural==.
 10.     replace urban_rural_bin=0 if urban_rural>4 & urban_rural!=.
 11.     label define urban_rural_bin 0 "Rural" 1 "Urban"
 12.     label values urban_rural_bin urban_rural_bin
 13.     safetab urban_rural_bin urban_rural, miss
 14.     label var urban_rural_bin "Rural-Urban"
 15.     
.     preserve
 16.     * Create baseline table
.     table1_mc, vars(age_cat cat \ sex cat \ imd cat \ urban_rural_bin cat  \ 
>  ///
>     has_t1_diabetes cat  \ has_t2_diabetes cat \ has_asthma cat \ has_copd ca
> t ) clear
 17.     export delimited using ./output/tables/baseline_table_`i'.csv
 18.     restore
 19.     preserve
 20.     * table by migration status
.     table1_mc, vars(age_cat cat \ sex cat \ imd cat \ urban_rural_bin cat  \ 
>  ///
>     has_t1_diabetes cat  \ has_t2_diabetes cat \ has_asthma cat \ has_copd ca
> t ) by(migration_status) clear
 21.     export delimited using ./output/tables/baseline_table_migration_`i'.cs
> v
 22.     restore
 23.     
.     gen imd_1 = (imd==1)
 24.     gen imd_2 = (imd==2)
 25.     gen imd_3 = (imd==3)
 26.     gen imd_4 = (imd==4)
 27.     gen imd_5 = (imd==5)
 28. 
.     tempfile tempfile
 29.     preserve
 30.     keep if imd==1
 31.     table1_mc, vars(age_cat cat \ sex cat \ imd cat \ urban_rural_bin cat 
>  \  ///
>     has_t1_diabetes cat  \ has_t2_diabetes cat \ has_asthma cat \ has_copd ca
> t) clear
 32.     save `tempfile', replace
 33.     restore
 34.     forvalues j=2/5 {
 35.       preserve
 36.       keep if imd==`j'
 37.       table1_mc, vars(age_cat cat \ sex cat \ imd cat \ urban_rural_bin ca
> t  \  ///
>       has_t1_diabetes cat  \ has_t2_diabetes cat \ has_asthma cat \ has_copd 
> cat) clear
 38.       append using `tempfile'
 39.       save `tempfile', replace
 40.       restore
 41.       }
 42.     use `tempfile', clear
 43.     export delimited using ./output/tables/baseline_table_imd`i'.csv
 44.     }
(22 vars, 1,000 obs)
variable imd not found
r(111);

end of do-file
r(111);

end of do-file

r(111);


